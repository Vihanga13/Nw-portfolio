import{p as A}from"./regexparam-CPXopyEH.js";import{r as o,b as B}from"./react-7zqVQZSl.js";import{s as F}from"./use-sync-external-store-Blj5SanI.js";const H=B.useInsertionEffect,M=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",N=M?o.useLayoutEffect:o.useEffect,V=H||N,L=e=>{const t=o.useRef([e,(...n)=>t[0](...n)]).current;return V(()=>{t[0]=e}),t[1]},T="popstate",E="pushState",P="replaceState",$="hashchange",b=[T,E,P,$],q=e=>{for(const t of b)addEventListener(t,e);return()=>{for(const t of b)removeEventListener(t,e)}},k=(e,t)=>F.useSyncExternalStore(q,e,t),z=()=>location.search,G=({ssrSearch:e=""}={})=>k(z,()=>e),R=()=>location.pathname,J=({ssrPath:e}={})=>k(R,e?()=>e:R),Q=(e,{replace:t=!1,state:n=null}={})=>history[t?P:E](n,"",e),W=(e={})=>[J(e),Q],x=Symbol.for("wouter_v3");if(typeof history<"u"&&typeof window[x]>"u"){for(const e of[E,P]){const t=history[e];history[e]=function(){const n=t.apply(this,arguments),s=new Event(e);return s.arguments=arguments,dispatchEvent(s),n}}Object.defineProperty(window,x,{value:!0})}const X=(e,t)=>t.toLowerCase().indexOf(e.toLowerCase())?"~"+t:t.slice(e.length)||"/",O=(e="")=>e==="/"?"":e,Y=(e,t)=>e[0]==="~"?e.slice(1):O(t)+e,Z=(e="",t)=>X(S(O(e)),S(t)),S=e=>{try{return decodeURI(e)}catch{return e}},j={hook:W,searchHook:G,parser:A,base:"",ssrPath:void 0,ssrSearch:void 0,hrefs:e=>e},I=o.createContext(j),y=()=>o.useContext(I),K={},_=o.createContext(K),ee=()=>o.useContext(_),g=e=>{const[t,n]=e.hook(e);return[Z(e.base,t),L((s,a)=>n(Y(s,e.base),a))]},D=(e,t,n,s)=>{const{pattern:a,keys:i}=t instanceof RegExp?{keys:!1,pattern:t}:e(t||"*",s),c=a.exec(n)||[],[f,...h]=c;return f!==void 0?[!0,(()=>{const r=i!==!1?Object.fromEntries(i.map((d,l)=>[d,h[l]])):c.groups;let u={...h};return r&&Object.assign(u,r),u})(),...s?[f]:[]]:[!1,null]},te=({children:e,...t})=>{var u,d;const n=y(),s=t.hook?j:n;let a=s;const[i,c]=((u=t.ssrPath)==null?void 0:u.split("?"))??[];c&&(t.ssrSearch=c,t.ssrPath=i),t.hrefs=t.hrefs??((d=t.hook)==null?void 0:d.hrefs);let f=o.useRef({}),h=f.current,r=h;for(let l in s){const p=l==="base"?s[l]+(t[l]||""):t[l]||s[l];h===r&&p!==r[l]&&(f.current=r={...r}),r[l]=p,p!==s[l]&&(a=r)}return o.createElement(I.Provider,{value:a,children:e})},C=({children:e,component:t},n)=>t?o.createElement(t,{params:n}):typeof e=="function"?e(n):e,ne=e=>{let t=o.useRef(K),n=t.current;for(const s in e)e[s]!==n[s]&&(n=e);return Object.keys(e).length===0&&(n=e),t.current=n},ae=({path:e,nest:t,match:n,...s})=>{const a=y(),[i]=g(a),[c,f,h]=n??D(a.parser,e,i,t),r=ne({...ee(),...f});if(!c)return null;const u=h?o.createElement(te,{base:h},C(s,r)):C(s,r);return o.createElement(_.Provider,{value:r,children:u})};o.forwardRef((e,t)=>{const n=y(),[s,a]=g(n),{to:i="",href:c=i,onClick:f,asChild:h,children:r,className:u,replace:d,state:l,...p}=e,v=L(m=>{m.ctrlKey||m.metaKey||m.altKey||m.shiftKey||m.button!==0||(f==null||f(m),m.defaultPrevented||(m.preventDefault(),a(c,e)))}),w=n.hrefs(c[0]==="~"?c.slice(1):n.base+c,n);return h&&o.isValidElement(r)?o.cloneElement(r,{onClick:v,href:w}):o.createElement("a",{...p,onClick:v,href:w,className:u!=null&&u.call?u(s===c):u,children:r,ref:t})});const U=e=>Array.isArray(e)?e.flatMap(t=>U(t&&t.type===o.Fragment?t.props.children:t)):[e],ce=({children:e,location:t})=>{const n=y(),[s]=g(n);for(const a of U(e)){let i=0;if(o.isValidElement(a)&&(i=D(n.parser,a.props.path,t||s,a.props.nest))[0])return o.cloneElement(a,{match:i})}return null};export{ae as R,ce as S};
